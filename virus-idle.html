<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virus Idle - Enhanced Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #00ff00;
            min-height: 100vh;
            padding: 20px;
            overflow-x: auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00ff00;
            font-size: 2.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff00;
        }

        .controls-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-panel {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
        }

        .control-panel h3 {
            margin-bottom: 15px;
            text-align: center;
            color: #00ff00;
        }

        .button-grid {
            display: grid;
            gap: 10px;
        }

        button {
            background: linear-gradient(45deg, #222, #333);
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 0.9rem;
        }

        button:hover:not(:disabled) {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button.selected {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            color: #000;
        }

        .network-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: radial-gradient(circle, #000 0%, #111 100%);
            border: 2px solid #00ff00;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .node {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: absolute;
            transition: all 0.3s ease;
            border: 2px solid #00ff00;
            background: #000;
        }

        .node.infected {
            background: #ff0000;
            border-color: #ff0000;
            box-shadow: 0 0 10px #ff0000;
        }

        .virus-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, #ff0000, #ff6666);
            transform-origin: 0 50%;
            pointer-events: none;
            box-shadow: 0 0 5px #ff0000;
        }

        .particle {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            position: absolute;
            background: #ff0000;
            pointer-events: none;
            opacity: 1;
            box-shadow: 0 0 5px #ff0000;
        }

        .prestige-section {
            text-align: center;
            margin-top: 20px;
        }

        #prestige-btn {
            background: linear-gradient(45deg, #ff6600, #ff8800);
            border-color: #ff6600;
            color: #fff;
            font-size: 1.2rem;
            padding: 15px 30px;
        }

        #prestige-btn:hover:not(:disabled) {
            background: linear-gradient(45deg, #ff8800, #ffaa00);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 102, 0, 0.4);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 0, 0.9);
            color: #000;
            padding: 15px 20px;
            border-radius: 5px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .save-load {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }

        .achievement-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .achievement-content {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: #00ff00;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 5px;
        }

        .achievement-item.unlocked {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }

        .achievement-icon {
            font-size: 1.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00cc00);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .controls-section {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü¶† Virus Idle - Enhanced Edition</h1>

        <div class="save-load">
            <button onclick="GameManager.save()">üíæ Save</button>
            <button onclick="GameManager.load()">üìÇ Load</button>
            <button onclick="GameManager.reset()">üîÑ Reset</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div>Points</div>
                <div class="stat-value" id="points">0</div>
            </div>
            <div class="stat-card">
                <div>Rate</div>
                <div class="stat-value" id="rate">0</div>
            </div>
            <div class="stat-card">
                <div>Prestige Bonus</div>
                <div class="stat-value" id="prestige">0%</div>
            </div>
            <div class="stat-card">
                <div>Current Virus</div>
                <div class="stat-value" id="currentVirus">Normal</div>
            </div>
            <div class="stat-card">
                <div>Infected Nodes</div>
                <div class="stat-value" id="infectedCount">0</div>
            </div>
            <div class="stat-card">
                <div>Total Nodes</div>
                <div class="stat-value" id="totalNodes">50</div>
            </div>
            <div class="stat-card">
                <div>Level</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat-card">
                <div>Experience</div>
                <div class="stat-value" id="experience">0</div>
            </div>
            <div class="stat-card">
                <div>Research Points</div>
                <div class="stat-value" id="researchPoints">0</div>
            </div>
            <div class="stat-card">
                <div>Time Played</div>
                <div class="stat-value" id="timePlayed">00:00</div>
            </div>
        </div>

        <div class="controls-section">
            <div class="control-panel">
                <h3>ü¶† Virus Selection</h3>
                <div class="button-grid">
                    <button id="normal-btn" onclick="VirusManager.selectVirus('normal')" class="selected">
                        Normal Virus (1x)
                    </button>
                    <button id="fast-btn" onclick="VirusManager.selectVirus('fast')">
                        Fast Virus (2x speed)
                    </button>
                    <button id="stealth-btn" onclick="VirusManager.selectVirus('stealth')" disabled>
                        Stealth Virus (3x stealth)
                    </button>
                    <button id="mutant-btn" onclick="VirusManager.selectVirus('mutant')" disabled>
                        Mutant Virus (5x power)
                    </button>
                </div>
            </div>

            <div class="control-panel">
                <h3>‚ö° Upgrades</h3>
                <div class="button-grid">
                    <button onclick="UpgradeManager.buyUpgrade('normal')" id="normal-upgrade">
                        Normal +1/s - <span id="normal-cost">10</span> pts
                    </button>
                    <button onclick="UpgradeManager.buyUpgrade('fast')" id="fast-upgrade">
                        Fast +0.5/s - <span id="fast-cost">30</span> pts
                    </button>
                    <button onclick="UpgradeManager.buyUpgrade('stealth')" id="stealth-upgrade">
                        Stealth +0.2/s - <span id="stealth-cost">50</span> pts
                    </button>
                    <button onclick="UpgradeManager.buyUpgrade('mutant')" id="mutant-upgrade" disabled>
                        Mutant +2/s - <span id="mutant-cost">200</span> pts
                    </button>
                </div>
            </div>

            <div class="control-panel">
                <h3>üéØ Skills</h3>
                <div class="button-grid">
                    <button onclick="SkillManager.buySkill('normal', 'chain')" id="chain-skill">
                        Chain Infection - 50 pts
                    </button>
                    <button onclick="SkillManager.buySkill('fast', 'resist')" id="resist-skill">
                        Resistance - 100 pts
                    </button>
                    <button onclick="SkillManager.buySkill('stealth', 'speed')" id="speed-skill">
                        Speed Boost - 150 pts
                    </button>
                </div>
            </div>

            <div class="control-panel">
                <h3>üî¨ Research</h3>
                <div class="button-grid">
                    <button onclick="ResearchManager.buyResearch('efficiency')" id="efficiency-research">
                        Efficiency Boost - 25 RP
                    </button>
                    <button onclick="ResearchManager.buyResearch('mutation')" id="mutation-research">
                        Mutation Rate - 50 RP
                    </button>
                    <button onclick="ResearchManager.buyResearch('resistance')" id="resistance-research">
                        Antivirus Resistance - 75 RP
                    </button>
                </div>
            </div>

            <div class="control-panel">
                <h3>üèÜ Achievements</h3>
                <div class="button-grid">
                    <button onclick="AchievementManager.showAchievements()" id="achievements-btn">
                        View Achievements
                    </button>
                    <button onclick="GameManager.toggleAutoUpgrade()" id="auto-upgrade-btn">
                        Auto Upgrade: OFF
                    </button>
                    <button onclick="GameManager.toggleAutoPrestige()" id="auto-prestige-btn">
                        Auto Prestige: OFF
                    </button>
                </div>
            </div>
        </div>

        <div class="network-container" id="network"></div>

        <div class="prestige-section">
            <button id="prestige-btn" onclick="PrestigeManager.prestige()">
                üöÄ Prestige (+10% Bonus)
            </button>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <div class="achievement-modal" id="achievement-modal">
        <div class="achievement-content">
            <h2>üèÜ Achievements</h2>
            <div id="achievements-list"></div>
            <button onclick="AchievementManager.hideAchievements()" style="margin-top: 20px;">Close</button>
        </div>
    </div>

    <script>
        // Game Configuration
        const CONFIG = {
            TOTAL_NODES: 50,
            CONNECTION_CHANCE: 0.15,
            INFECTION_CHANCE: 0.02,
            GAME_TICK: 500,
            EVENT_INTERVAL: 7000,
            PARTICLE_LIFETIME: 30,
            ANIMATION_SPEED: 16,
            AUTO_UPGRADE_THRESHOLD: 0.8,
            AUTO_PRESTIGE_THRESHOLD: 1000
        };

        // Game State Management
        class GameState {
            constructor() {
                this.points = 0;
                this.prestigeBonus = 0;
                this.selectedVirus = 'normal';
                this.level = 1;
                this.experience = 0;
                this.researchPoints = 0;
                this.timePlayed = 0;
                this.autoUpgrade = false;
                this.autoPrestige = false;
                this.virusRates = {
                    normal: 1,
                    fast: 0,
                    stealth: 0,
                    mutant: 0
                };
                this.upgradeCosts = {
                    normal: 10,
                    fast: 30,
                    stealth: 50,
                    mutant: 200
                };
                this.skillCosts = {
                    normal: { chain: 50 },
                    fast: { resist: 100 },
                    stealth: { speed: 150 }
                };
                this.skillsBought = {
                    normal: { chain: false },
                    fast: { resist: false },
                    stealth: { speed: false },
                    mutant: {}
                };
                this.researchBought = {
                    efficiency: false,
                    mutation: false,
                    resistance: false
                };
                this.unlockedViruses = {
                    normal: true,
                    fast: true,
                    stealth: false,
                    mutant: false
                };
            }

            getTotalRate() {
                return (this.virusRates.normal + this.virusRates.fast + 
                        this.virusRates.stealth + this.virusRates.mutant) * 
                       (1 + this.prestigeBonus / 100);
            }

            getInfectedCount() {
                return document.querySelectorAll('.node.infected').length;
            }

            getExperienceToNextLevel() {
                return this.level * 100;
            }

            addExperience(amount) {
                this.experience += amount;
                while (this.experience >= this.getExperienceToNextLevel()) {
                    this.experience -= this.getExperienceToNextLevel();
                    this.level++;
                    this.researchPoints += 5;
                    DisplayManager.showNotification(`üéâ Level ${this.level} reached! +5 Research Points!`);
                }
            }
        }

        // Display Management
        class DisplayManager {
            static updateDisplay() {
                const state = GameManager.state;
                
                document.getElementById('points').textContent = 
                    Math.floor(state.points).toLocaleString();
                document.getElementById('rate').textContent = 
                    state.getTotalRate().toFixed(1);
                document.getElementById('prestige').textContent = 
                    state.prestigeBonus + '%';
                document.getElementById('currentVirus').textContent = 
                    state.selectedVirus.charAt(0).toUpperCase() + 
                    state.selectedVirus.slice(1);
                document.getElementById('infectedCount').textContent = 
                    state.getInfectedCount();
                document.getElementById('level').textContent = state.level;
                document.getElementById('experience').textContent = 
                    `${state.experience}/${state.getExperienceToNextLevel()}`;
                document.getElementById('researchPoints').textContent = state.researchPoints;
                document.getElementById('timePlayed').textContent = 
                    this.formatTime(state.timePlayed);
                
                // Update upgrade costs
                Object.keys(state.upgradeCosts).forEach(type => {
                    const element = document.getElementById(`${type}-cost`);
                    if (element) {
                        element.textContent = state.upgradeCosts[type];
                    }
                });

                // Update auto buttons
                document.getElementById('auto-upgrade-btn').textContent = 
                    `Auto Upgrade: ${state.autoUpgrade ? 'ON' : 'OFF'}`;
                document.getElementById('auto-prestige-btn').textContent = 
                    `Auto Prestige: ${state.autoPrestige ? 'ON' : 'OFF'}`;
            }

            static formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            static showNotification(message, duration = 3000) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, duration);
            }
        }

        // Virus Management
        class VirusManager {
            static selectVirus(type) {
                const state = GameManager.state;
                if (!state.unlockedViruses[type]) return;
                
                state.selectedVirus = type;
                
                // Update button states
                document.querySelectorAll('#virus-select button').forEach(btn => 
                    btn.classList.remove('selected'));
                document.getElementById(`${type}-btn`).classList.add('selected');
                
                DisplayManager.updateDisplay();
            }
        }

        // Upgrade Management
        class UpgradeManager {
            static buyUpgrade(type) {
                const state = GameManager.state;
                const cost = state.upgradeCosts[type];
                
                if (state.points < cost) {
                    DisplayManager.showNotification('‚ùå Not enough points!');
                    return;
                }
                
                state.points -= cost;
                
                // Apply upgrade effects
                const effects = {
                    normal: 1,
                    fast: 0.5,
                    stealth: 0.2,
                    mutant: 2
                };
                
                state.virusRates[type] += effects[type];
                state.upgradeCosts[type] = Math.floor(cost * 1.5);
                
                DisplayManager.updateDisplay();
                DisplayManager.showNotification(`‚úÖ ${type} virus upgraded!`);
            }
        }

        // Skill Management
        class SkillManager {
            static buySkill(type, skill) {
                const state = GameManager.state;
                
                if (state.skillsBought[type][skill]) {
                    DisplayManager.showNotification('‚ùå Skill already purchased!');
                    return;
                }
                
                const cost = state.skillCosts[type][skill];
                if (state.points < cost) {
                    DisplayManager.showNotification('‚ùå Not enough points!');
                    return;
                }
                
                state.points -= cost;
                state.skillsBought[type][skill] = true;
                
                // Apply skill effects
                const effects = {
                    chain: () => { state.virusRates.normal += 0.5; },
                    resist: () => { state.virusRates.fast += 0.5; },
                    speed: () => { state.virusRates.stealth += 0.3; }
                };
                
                effects[skill]();
                
                DisplayManager.updateDisplay();
                DisplayManager.showNotification(`üéØ ${skill} skill acquired!`);
            }
        }

        // Network Management
        class NetworkManager {
            static nodes = [];
            static connections = [];
            
            static initialize() {
                const network = document.getElementById('network');
                
                // Create nodes
                for (let i = 0; i < CONFIG.TOTAL_NODES; i++) {
                    const node = document.createElement('div');
                    node.className = 'node';
                    node.style.left = Math.random() * (network.clientWidth - 12) + 'px';
                    node.style.top = Math.random() * (network.clientHeight - 12) + 'px';
                    node.dataset.infected = '0';
                    network.appendChild(node);
                    this.nodes.push(node);
                }
                
                // Create connections
                for (let i = 0; i < CONFIG.TOTAL_NODES; i++) {
                    this.connections[i] = [];
                    for (let j = 0; j < CONFIG.TOTAL_NODES; j++) {
                        if (i !== j && Math.random() < CONFIG.CONNECTION_CHANCE) {
                            this.connections[i].push(j);
                        }
                    }
                }
            }
            
            static spreadInfection() {
                const state = GameManager.state;
                const infectionChance = CONFIG.INFECTION_CHANCE * state.getTotalRate();
                
                this.nodes.forEach((node, i) => {
                    if (Math.random() < infectionChance) {
                        const connections = this.connections[i];
                        if (connections.length > 0) {
                            const targetIndex = connections[Math.floor(Math.random() * connections.length)];
                            const targetNode = this.nodes[targetIndex];
                            
                            if (targetNode && targetNode.dataset.infected === '0') {
                                this.animateInfection(node, targetNode);
                                targetNode.dataset.infected = '1';
                                targetNode.classList.add('infected');
                            }
                        }
                    }
                });
            }
            
            static animateInfection(source, target) {
                const x1 = parseFloat(source.style.left) + 6;
                const y1 = parseFloat(source.style.top) + 6;
                const x2 = parseFloat(target.style.left) + 6;
                const y2 = parseFloat(target.style.top) + 6;
                
                // Create infection line
                const line = document.createElement('div');
                line.className = 'virus-line';
                const dx = x2 - x1;
                const dy = y2 - y1;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                line.style.width = '0px';
                line.style.left = x1 + 'px';
                line.style.top = y1 + 'px';
                line.style.transform = `rotate(${angle}deg)`;
                
                document.getElementById('network').appendChild(line);
                
                // Animate line
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    line.style.width = progress + 'px';
                    
                    if (progress >= length) {
                        clearInterval(interval);
                        document.getElementById('network').removeChild(line);
                        this.createParticle(x2, y2);
                    }
                }, CONFIG.ANIMATION_SPEED);
            }
            
            static createParticle(x, y) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                document.getElementById('network').appendChild(particle);
                
                let dx = (Math.random() - 0.5) * 4;
                let dy = (Math.random() - 0.5) * 4;
                let life = CONFIG.PARTICLE_LIFETIME;
                
                const interval = setInterval(() => {
                    dx *= 0.95;
                    dy *= 0.95;
                    life--;
                    
                    particle.style.left = parseFloat(particle.style.left) + dx + 'px';
                    particle.style.top = parseFloat(particle.style.top) + dy + 'px';
                    particle.style.opacity = life / CONFIG.PARTICLE_LIFETIME;
                    
                    if (life <= 0) {
                        clearInterval(interval);
                        document.getElementById('network').removeChild(particle);
                    }
                }, CONFIG.ANIMATION_SPEED);
            }
            
            static reset() {
                this.nodes.forEach(node => {
                    node.dataset.infected = '0';
                    node.classList.remove('infected');
                });
            }
        }

        // Prestige Management
        class PrestigeManager {
            static prestige() {
                const state = GameManager.state;
                
                if (state.points < 100) {
                    DisplayManager.showNotification('‚ùå Need at least 100 points to prestige!');
                    return;
                }
                
                state.prestigeBonus += 10;
                state.points = 0;
                state.virusRates = { normal: 1, fast: 0, stealth: 0, mutant: 0 };
                state.upgradeCosts = { normal: 10, fast: 30, stealth: 50, mutant: 200 };
                state.skillsBought = {
                    normal: { chain: false },
                    fast: { resist: false },
                    stealth: { speed: false },
                    mutant: {}
                };
                
                // Unlock new viruses
                if (state.prestigeBonus >= 20) {
                    state.unlockedViruses.stealth = true;
                    document.getElementById('stealth-btn').disabled = false;
                }
                if (state.prestigeBonus >= 50) {
                    state.unlockedViruses.mutant = true;
                    document.getElementById('mutant-btn').disabled = false;
                }
                
                NetworkManager.reset();
                DisplayManager.updateDisplay();
                DisplayManager.showNotification('üöÄ Prestige! +10% bonus applied!', 5000);
            }
        }

        // Save/Load Management
        class SaveManager {
            static save() {
                const saveData = {
                    state: GameManager.state,
                    timestamp: Date.now()
                };
                localStorage.setItem('virusIdleSave', JSON.stringify(saveData));
                DisplayManager.showNotification('üíæ Game saved!');
            }
            
            static load() {
                const saveData = localStorage.getItem('virusIdleSave');
                if (saveData) {
                    try {
                        const data = JSON.parse(saveData);
                        Object.assign(GameManager.state, data.state);
                        DisplayManager.updateDisplay();
                        DisplayManager.showNotification('üìÇ Game loaded!');
                    } catch (error) {
                        DisplayManager.showNotification('‚ùå Failed to load save!');
                    }
                } else {
                    DisplayManager.showNotification('‚ùå No save data found!');
                }
            }
            
            static reset() {
                if (confirm('Are you sure you want to reset your progress? This cannot be undone!')) {
                    localStorage.removeItem('virusIdleSave');
                    GameManager.state = new GameState();
                    NetworkManager.reset();
                    DisplayManager.updateDisplay();
                    DisplayManager.showNotification('üîÑ Game reset!');
                }
            }
        }

        // Research Management
        class ResearchManager {
            static buyResearch(type) {
                const state = GameManager.state;
                const costs = {
                    efficiency: 25,
                    mutation: 50,
                    resistance: 75
                };
                
                if (state.researchPoints < costs[type]) {
                    DisplayManager.showNotification('‚ùå Not enough research points!');
                    return;
                }
                
                if (state.researchBought[type]) {
                    DisplayManager.showNotification('‚ùå Research already completed!');
                    return;
                }
                
                state.researchPoints -= costs[type];
                state.researchBought[type] = true;
                
                // Apply research effects
                const effects = {
                    efficiency: () => { 
                        Object.keys(state.virusRates).forEach(key => {
                            state.virusRates[key] *= 1.2;
                        });
                    },
                    mutation: () => { 
                        CONFIG.INFECTION_CHANCE *= 1.5;
                    },
                    resistance: () => { 
                        // Reduces antivirus effectiveness
                    }
                };
                
                effects[type]();
                DisplayManager.updateDisplay();
                DisplayManager.showNotification(`üî¨ ${type} research completed!`);
            }
        }

        // Achievement Management
        class AchievementManager {
            static achievements = {
                firstInfection: { name: "First Infection", description: "Infect your first node", icon: "ü¶†", unlocked: false, progress: 0, target: 1 },
                level10: { name: "Level 10", description: "Reach level 10", icon: "üìà", unlocked: false, progress: 0, target: 10 },
                prestige1: { name: "First Prestige", description: "Complete your first prestige", icon: "üöÄ", unlocked: false, progress: 0, target: 1 },
                researchMaster: { name: "Research Master", description: "Complete all research", icon: "üî¨", unlocked: false, progress: 0, target: 3 },
                timePlayed: { name: "Dedicated Player", description: "Play for 1 hour", icon: "‚è∞", unlocked: false, progress: 0, target: 3600 }
            };

            static checkAchievements() {
                const state = GameManager.state;
                
                // First Infection
                if (state.getInfectedCount() >= 1 && !this.achievements.firstInfection.unlocked) {
                    this.achievements.firstInfection.unlocked = true;
                    DisplayManager.showNotification('üèÜ Achievement Unlocked: First Infection!');
                }
                
                // Level 10
                if (state.level >= 10 && !this.achievements.level10.unlocked) {
                    this.achievements.level10.unlocked = true;
                    DisplayManager.showNotification('üèÜ Achievement Unlocked: Level 10!');
                }
                
                // First Prestige
                if (state.prestigeBonus >= 10 && !this.achievements.prestige1.unlocked) {
                    this.achievements.prestige1.unlocked = true;
                    DisplayManager.showNotification('üèÜ Achievement Unlocked: First Prestige!');
                }
                
                // Research Master
                const completedResearch = Object.values(state.researchBought).filter(b => b).length;
                if (completedResearch >= 3 && !this.achievements.researchMaster.unlocked) {
                    this.achievements.researchMaster.unlocked = true;
                    DisplayManager.showNotification('üèÜ Achievement Unlocked: Research Master!');
                }
                
                // Time Played
                if (state.timePlayed >= 3600 && !this.achievements.timePlayed.unlocked) {
                    this.achievements.timePlayed.unlocked = true;
                    DisplayManager.showNotification('üèÜ Achievement Unlocked: Dedicated Player!');
                }
            }

            static showAchievements() {
                const modal = document.getElementById('achievement-modal');
                const list = document.getElementById('achievements-list');
                list.innerHTML = '';
                
                Object.entries(this.achievements).forEach(([key, achievement]) => {
                    const item = document.createElement('div');
                    item.className = `achievement-item ${achievement.unlocked ? 'unlocked' : ''}`;
                    
                    const progress = Math.min(achievement.progress / achievement.target, 1);
                    
                    item.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div style="flex: 1;">
                            <div><strong>${achievement.name}</strong></div>
                            <div>${achievement.description}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress * 100}%"></div>
                            </div>
                            <div>${achievement.progress}/${achievement.target}</div>
                        </div>
                    `;
                    
                    list.appendChild(item);
                });
                
                modal.style.display = 'flex';
            }

            static hideAchievements() {
                document.getElementById('achievement-modal').style.display = 'none';
            }
        }

        // Main Game Manager
        class GameManager {
            static state = new GameState();
            static gameInterval = null;
            static eventInterval = null;
            static timeInterval = null;
            
            static initialize() {
                NetworkManager.initialize();
                DisplayManager.updateDisplay();
                this.startGameLoop();
                this.startEventLoop();
                this.startTimeTracking();
                
                // Auto-save every 30 seconds
                setInterval(() => {
                    this.save();
                }, 30000);
            }

            static startTimeTracking() {
                this.timeInterval = setInterval(() => {
                    this.state.timePlayed++;
                    DisplayManager.updateDisplay();
                    AchievementManager.checkAchievements();
                }, 1000);
            }

            static toggleAutoUpgrade() {
                this.state.autoUpgrade = !this.state.autoUpgrade;
                DisplayManager.updateDisplay();
                DisplayManager.showNotification(`Auto Upgrade ${this.state.autoUpgrade ? 'enabled' : 'disabled'}`);
            }

            static toggleAutoPrestige() {
                this.state.autoPrestige = !this.state.autoPrestige;
                DisplayManager.updateDisplay();
                DisplayManager.showNotification(`Auto Prestige ${this.state.autoPrestige ? 'enabled' : 'disabled'}`);
            }
            
            static startGameLoop() {
                this.gameInterval = setInterval(() => {
                    this.state.points += this.state.getTotalRate() / 2;
                    this.state.addExperience(1);
                    NetworkManager.spreadInfection();
                    DisplayManager.updateDisplay();
                    
                    // Auto upgrade logic
                    if (this.state.autoUpgrade) {
                        this.autoUpgradeLogic();
                    }
                    
                    // Auto prestige logic
                    if (this.state.autoPrestige && this.state.points >= CONFIG.AUTO_PRESTIGE_THRESHOLD) {
                        PrestigeManager.prestige();
                    }
                }, CONFIG.GAME_TICK);
            }

            static autoUpgradeLogic() {
                const state = this.state;
                const upgradeTypes = ['normal', 'fast', 'stealth', 'mutant'];
                
                for (const type of upgradeTypes) {
                    if (state.points >= state.upgradeCosts[type] * CONFIG.AUTO_UPGRADE_THRESHOLD) {
                        UpgradeManager.buyUpgrade(type);
                        break;
                    }
                }
            }
            
            static startEventLoop() {
                this.eventInterval = setInterval(() => {
                    this.randomEvent();
                }, CONFIG.EVENT_INTERVAL);
            }
            
            static randomEvent() {
                if (Math.random() < 0.1) {
                    const infectedNodes = document.querySelectorAll('.node.infected');
                    if (infectedNodes.length > 0) {
                        const randomNode = infectedNodes[Math.floor(Math.random() * infectedNodes.length)];
                        randomNode.dataset.infected = '0';
                        randomNode.classList.remove('infected');
                        DisplayManager.showNotification('üõ°Ô∏è Antivirus reduced effectiveness!');
                    }
                }
            }
            
            static save() {
                SaveManager.save();
            }
            
            static load() {
                SaveManager.load();
            }
            
            static reset() {
                SaveManager.reset();
            }
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            GameManager.initialize();
        });
    </script>
</body>
</html>
